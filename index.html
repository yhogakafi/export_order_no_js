<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF to Excel</title>
    <script src="https://unpkg.com/pdf-lib@1.17.1"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
</head>
<body>
    <input type="file" id="pdf-file" />
    <button onclick="extractData()">Extract Data</button>
    <script>
        async function extractData() {
            const fileInput = document.getElementById('pdf-file');
            const file = fileInput.files[0];
            if (!file) {
                alert('Please select a PDF file.');
                return;
            }

            const arrayBuffer = await file.arrayBuffer();
            const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
            const pages = pdfDoc.getPages();
            let text = '';

            for (const page of pages) {
                const pageText = await page.getTextContent();
                text += pageText.items.map(item => item.str).join(' ');
            }

            // Keyword extraction
            const keyword = 'No. Pesanan: ';
            const dataAfterKeyword = extractDataAfterKeyword(text, keyword);

            if (dataAfterKeyword.length === 0) {
                alert('No data found after the keyword.');
                return;
            }

            // Create Excel file
            const workbook = XLSX.utils.book_new();
            const worksheet = XLSX.utils.aoa_to_sheet([['Data'], ...dataAfterKeyword.map(item => [item])]);
            XLSX.utils.book_append_sheet(workbook, worksheet, 'Sheet1');

            // Export Excel file
            const excelBuffer = XLSX.write(workbook, { bookType: 'xlsx', type: 'array' });
            saveAsExcelFile(excelBuffer, 'extracted_data.xlsx');
        }

        function extractDataAfterKeyword(text, keyword) {
            const regex = new RegExp(`${keyword}(\\S+)`, 'g');
            const matches = [...text.matchAll(regex)];
            return matches.map(match => match[1]);
        }

        function saveAsExcelFile(buffer, filename) {
            const blob = new Blob([buffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
        }
    </script>
</body>
</html>
